<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Tinder Cesur</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/estilos.css}">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/}"><i class="fas fa-fire"></i> Tinder Cesur</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">

                <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                    <a class="nav-link text-warning fw-bold" th:href="@{/admin}">
                        <i class="fas fa-cogs"></i> Gestión
                    </a>
                </li>

                <li class="nav-item"><a class="nav-link active" th:href="@{/}">Descubrir</a></li>

                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <a class="nav-link" th:href="@{/matches/mis-matches}">Matches</a>
                </li>
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <a class="nav-link" th:href="@{/perfil}">Perfil</a>
                </li>
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <a class="nav-link" th:href="@{/logout}">Salir</a>
                </li>

                <li class="nav-item" sec:authorize="!isAuthenticated()">
                    <a class="nav-link fw-bold" th:href="@{/login}">Iniciar Sesión</a>
                </li>
                <li class="nav-item" sec:authorize="!isAuthenticated()">
                    <a class="nav-link btn btn-light text-dark px-3 ms-2 rounded-pill"
                       style="background: white; color: #fe3c72 !important;"
                       th:href="@{/register}">Registrarse</a>
                </li>

            </ul>
        </div>
    </div>
</nav>

<div class="container" style="margin-top: 90px; margin-bottom: 50px;">

    <div class="filters-container">
        <a th:href="@{/}"
           class="filter-chip"
           th:classappend="${filtroActivo == null} ? 'active' : ''">
            <i class="fas fa-layer-group me-1"></i> Todos
        </a>

        <a th:each="tema : ${listaIntereses}"
           th:href="@{/(filtro=${tema})}"
           class="filter-chip"
           th:classappend="${filtroActivo == tema} ? 'active' : ''"
           th:text="${tema}">
            Etiqueta
        </a>
    </div>

    <div th:if="${param.match}" class="alert alert-success text-center rounded-pill mb-4 shadow-sm">
        ¡HICISTE MATCH! ❤️ <a th:href="@{/matches/mis-matches}" class="alert-link">Ver matches</a>
    </div>

    <div th:if="${usuarioCandidato != null}" class="card-tinder">

        <div id="carouselExampleIndicators" class="carousel slide card-imagen" data-bs-ride="carousel" data-bs-interval="false">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"></button>
                <th:block th:each="foto, iter : ${usuarioCandidato.fotosGaleria}">
                    <button type="button" data-bs-target="#carouselExampleIndicators" th:data-bs-slide-to="${iter.index + 1}"></button>
                </th:block>
            </div>

            <div class="carousel-inner h-100">
                <div class="carousel-item active h-100">
                    <img th:src="${usuarioCandidato.avatar != null ? '/file/download/' + usuarioCandidato.avatar : '/img/logo-mini.png'}" alt="Avatar">
                </div>
                <div class="carousel-item h-100" th:each="foto : ${usuarioCandidato.fotosGaleria}">
                    <img th:src="${'/file/download/' + foto.nombreArchivo}" alt="Foto Galeria">
                </div>
            </div>

            <button th:if="${!usuarioCandidato.fotosGaleria.isEmpty()}" class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </button>
            <button th:if="${!usuarioCandidato.fotosGaleria.isEmpty()}" class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </button>
        </div>

        <div class="card-body-content">
            <a th:href="@{'/usuario/' + ${usuarioCandidato.id}}" class="text-decoration-none text-dark">
                <h2>
                    <span th:text="${usuarioCandidato.name}">Nombre</span>,
                    <span class="fw-normal fs-4 text-muted" th:text="${usuarioCandidato.edad}">24</span>
                </h2>
            </a>

            <div class="mb-2">
                <span class="badge rounded-pill bg-light text-dark border"
                      style="font-size: 0.8rem; font-weight: 600;"
                      th:text="${usuarioCandidato.interes}">INTERÉS</span>
            </div>

            <p class="bio-text" th:text="${usuarioCandidato.biografia}">
                Biografía...
            </p>
        </div>

        <div class="card-acciones-container">
            <form th:action="@{'/matches/dislike/' + ${usuarioCandidato.id}}" method="post">
                <button type="submit" class="btn-action-big btn-dislike" title="Nope">
                    <i class="fas fa-times"></i>
                </button>
            </form>
            <form th:action="@{'/matches/like/' + ${usuarioCandidato.id}}" method="post">
                <button type="submit" class="btn-action-big btn-like" title="Like">
                    <i class="fas fa-heart"></i>
                </button>
            </form>
        </div>
    </div>

    <div th:unless="${usuarioCandidato != null}" class="text-center mt-5 text-muted">
        <i class="fas fa-search fa-3x mb-3 text-secondary"></i>
        <h3>No hay más perfiles</h3>

        <p th:if="${filtroActivo == null}">Has visto a todo el mundo por hoy.</p>
        <p th:if="${filtroActivo != null}">
            No hay nadie con el interés <strong th:text="${filtroActivo}"></strong> cerca.
            <br> <a th:href="@{/}" class="text-primary text-decoration-none">Ver a todos</a>
        </p>

        <div sec:authorize="isAuthenticated()">
            <a th:href="@{/perfil}" class="btn btn-primary rounded-pill mt-2">Editar mi perfil</a>
        </div>
        <div sec:authorize="!isAuthenticated()">
            <a th:href="@{/register}" class="btn btn-primary rounded-pill mt-2">Crear cuenta gratis</a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>