<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${usuario.name} + ' - Perfil'">Perfil Usuario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/estilos.css}">
    <style>
        /* Pequeña animación para cuando pasas el ratón por el corazón de la foto */
        .btn-like-foto:hover .fa-heart {
            transform: scale(1.2);
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/}"><i class="fas fa-fire"></i> Tinder App</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" th:href="@{/}">Descubrir</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/matches/mis-matches}">Matches</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/perfil}">Perfil</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/logout}">Salir</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container" style="margin-top: 100px; margin-bottom: 50px;">

    <div class="mb-3 text-center">
        <a href="javascript:history.back()" class="btn btn-outline-secondary rounded-pill px-4">
            <i class="fas fa-arrow-left me-2"></i> Volver
        </a>
    </div>

    <div class="card-tinder">

        <div id="carouselPerfil" class="carousel slide card-imagen" data-bs-ride="carousel" data-bs-interval="false">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselPerfil" data-bs-slide-to="0" class="active"></button>
                <th:block th:each="foto, iter : ${usuario.fotosGaleria}">
                    <button type="button" data-bs-target="#carouselPerfil" th:data-bs-slide-to="${iter.index + 1}"></button>
                </th:block>
            </div>

            <div class="carousel-inner h-100">
                <div class="carousel-item active h-100">
                    <img th:src="${usuario.avatar != null ? '/file/download/' + usuario.avatar : '/img/logo-mini.png'}" alt="Avatar">
                </div>
                <div class="carousel-item h-100" th:each="foto : ${usuario.fotosGaleria}">
                    <img th:src="${'/file/download/' + foto.nombreArchivo}" alt="Foto Galeria">
                </div>
            </div>

            <button th:if="${!usuario.fotosGaleria.isEmpty()}" class="carousel-control-prev" type="button" data-bs-target="#carouselPerfil" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </button>
            <button th:if="${!usuario.fotosGaleria.isEmpty()}" class="carousel-control-next" type="button" data-bs-target="#carouselPerfil" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </button>
        </div>

        <div class="card-body-content">
            <h2>
                <span th:text="${usuario.name}">Nombre</span>
                <span class="age" th:if="${usuario.edad != null}" th:text="', ' + ${usuario.edad}">, 24</span>
            </h2>

            <div class="mb-2 text-muted" style="font-size: 0.9rem;">
                <span th:if="${usuario.ubicacion != null}">
                    <i class="fas fa-map-marker-alt text-danger me-1"></i> <span th:text="${usuario.ubicacion}">Madrid</span>
                </span>
            </div>

            <div class="mb-3">
                <span class="badge rounded-pill bg-light text-dark border"
                      style="font-size: 0.8rem; font-weight: 600;"
                      th:text="${usuario.interes}">INTERÉS</span>
            </div>

            <hr>

            <p class="bio-text" th:text="${usuario.biografia}">
                Sin biografía...
            </p>
        </div>

        <div class="p-3 bg-white text-center">
            <div th:if="${estado == 'MATCH'}">
                <div class="alert alert-success rounded-pill py-2 mb-3">
                    <i class="fas fa-heart text-danger"></i> ¡Sois Match!
                </div>
                <a th:href="@{'/chat/' + ${usuario.id}}" class="btn btn-primary w-100 rounded-pill fw-bold"
                   style="background: linear-gradient(45deg, #fe3c72, #ff655b); border: none;">
                    <i class="fas fa-comments me-2"></i> Volver al Chat
                </a>
            </div>

            <div th:if="${estado == 'LIKED'}">
                <button class="btn btn-secondary w-100 rounded-pill" disabled>
                    <i class="fas fa-clock me-2"></i> Esperando respuesta...
                </button>
            </div>

            <div th:if="${estado == 'NADA'}" class="d-flex justify-content-center gap-4 py-2">
                <form th:action="@{'/matches/dislike/' + ${usuario.id}}" method="post">
                    <button type="submit" class="btn-action-big btn-dislike" title="Nope">
                        <i class="fas fa-times"></i>
                    </button>
                </form>
                <form th:action="@{'/matches/like/' + ${usuario.id}}" method="post">
                    <button type="submit" class="btn-action-big btn-like" title="Like">
                        <i class="fas fa-heart"></i>
                    </button>
                </form>
            </div>
        </div>

        <div class="p-4 bg-light" th:if="${!usuario.fotosGaleria.isEmpty()}" style="border-top: 1px solid #eee;">
            <h5 class="fw-bold text-center mb-4" style="color: #fd267a;">Galería de Fotos <i class="fas fa-camera-retro"></i></h5>

            <div class="row g-3">
                <div class="col-6" th:each="foto : ${usuario.fotosGaleria}">
                    <div class="position-relative shadow-sm" style="border-radius: 15px; overflow: hidden;">

                        <img th:src="${'/file/download/' + foto.nombreArchivo}"
                             class="w-100" style="height: 200px; object-fit: cover;">

                        <div style="position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%); padding: 20px 10px 10px 10px; display: flex; align-items: flex-end; justify-content: center;">

                            <form th:action="@{'/foto/like/' + ${foto.id}}" method="post">
                                <button type="submit" class="btn-like-foto" style="background: none; border: none; padding: 0; cursor: pointer; display: flex; align-items: center; transition: transform 0.2s;">

                                    <i class="fas fa-heart fa-2x me-2"
                                       th:classappend="${foto.isLikedBy(miUsuario) ? 'text-danger' : 'text-white'}"
                                       style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); transition: color 0.3s;"></i>

                                    <span th:text="${foto.likes}" class="text-white" style="font-size: 1.5rem; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">0</span>
                                </button>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>